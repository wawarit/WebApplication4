
@{
    ViewBag.Title = "Index";
    Layout = null;
}



<style media="screen">
    .container {
        border: 0px solid darkgrey;
        border-radius: 3px;
        padding: 5px;
        width: 99%;
        margin: 0 auto;
    }

    .hightligh a {
        background: #FF0000 !important;
        color: #FFFF00 !important;
    }

    .highlight-event a {
        background: #32cd32 !important;
        color: #000000 !important;
    }


    .ui-datepicker {
        background: #B0C4DE;
        border: 1px solid #555;
        color: #000000;
    }
</style>

<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>



<script>
    $(document).ready(function () {
        /*var queryDate = '1/1/2022';*/
        var queryDate = null;

        /*queryDate = '1/1/' + currentYear;*/


        $(function () {
            $("#year").change(function () {
                $('#datepicker').datepicker("destroy");
                var conceptName = $('#year').find(":selected").text();
                higHlightDays(conceptName);
            });
        });

        higHlightDays();
        function higHlightDays(year)
        {
            if (year == null) {
                queryDate = null;
            }
            else {
                queryDate = '1/1/' + year;
            }
            var dataHoliday =
            {
                Year: year
            }
            $.ajax({
                url: '@Url.Action("getEventday", "Calendar")',
                type: "POST",
                data: JSON.stringify(dataHoliday),
                dataType: "json",
                contentType: "application/json",
                beforeSend: function () {

                },
                success: function (json) {

                    if ((json[0].Status.Status) && (json[0].Status.Success)) {

                        var listDataTableaHoliday = json[0].Details.dataTableaHoliday;
                        var listDataTableEvents = json[0].Details.dataTableEvents
                        var dataHoliday = JSON.parse(listDataTableaHoliday);
                        var dataEvents = JSON.parse(listDataTableEvents);

                        $('#datepicker').datepicker({
                            beforeShowDay: function (date) {
                                return setHoliday(date, dataHoliday, dataEvents);
                            }
                            ,defaultDate: queryDate
                        });


                    }
                },
                complete: function () {
                    //$(".loading").hide();
                },
                error: function (response) {
                    // document.getElementById("text-error").innerHTML = "You can't check back the past year.";
                }
            });
        }
        function setHoliday(date, jsonHoliday,jsonEvents) {

            if (jsonHoliday != null)
            {
                const dates = [];
                const tips = [];
                for (let i = 0; i < jsonHoliday.length; i++) {
                    dates.push(jsonHoliday[i].Day_Holiday);
                    tips.push(jsonHoliday[i].Details);
                }
                var month = date.getMonth() + 1;
                var year = date.getFullYear();
                var day = date.getDate();
                var newdate = day + "/" + month + '/' + year;
                for (var i = 0; i < dates.length; i++) {
                    if (dates[i].toString() == newdate) {
                        return [true, 'hightligh', tips[i]];
                    }
                }
            }

            if (jsonEvents != null)
            {
                const eventDates = [];
                const eventTitles = [];

                for (let i = 0; i < jsonEvents.length; i++) {
                    eventDates.push(jsonEvents[i].EventDate);
                    eventTitles.push(jsonEvents[i].Subject);
                }

                var month = date.getMonth() + 1;
                var year = date.getFullYear();
                var day = date.getDate();
                var newDate = day + "/" + month + '/' + year;

                for (var i = 0; i < eventDates.length; i++) {
                    if (eventDates[i].toString() == newDate) {
                        return [true, 'highlight-event', eventTitles[i]];
                    }
                }
            }

            return [true, ''];
        }

    });




</script>

<div class='container'>
    <select id="year">
        @for (int year = DateTime.Now.Year; year >= 2021; year--)
        {
            <option value="@year">@year</option>

        }
    </select>

    <div id="datepicker"></div>
    @*<input type="date" id="dtFrom" name="dtFrom" />
        <button id="DateChanger">Click</button>*@



</div>

<!DOCTYPE html>
<html>
<head>
    <title>ThaiCreate.Com</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // retrieve data from the database and add it to the table
            $.ajax({
                type: "GET",
                url: "/Home/GetData", // replace with the URL of your server-side code that retrieves the data from the database
                success: function (data) {
                    $.each(data, function (index, item) {
                        var tr = "<tr>";
                        tr = tr + "<td>" + item.Day_Holiday + "</td>";
                        tr = tr + "<td>" + item.Details + "</td>";
                        tr = tr + "</tr>";
                        $('#myTable > tbody:last').append(tr);
                    });
                },
                error: function (data) {
                    alert("Error retrieving data from database.");
                }
            });

            $("#deleteRows").click(function () {
                if ($("#myTable tr").length != 1) {
                    $("#myTable tr:last").remove();
                }
            });

            $("#clearRows").click(function () {
                $('#myTable > tbody:last').empty(); // remove all
            });

    </script>
    <meta charset=utf-8 />
</head>
<body>
    <center>
        <h1>Calendar</h1>

        <table width="600" border="1" id="myTable">
            <!-- head table -->
            <thead>
                <tr>
                    <td width="91"> <div align="center">Day_Holiday </div></td>
                    <td width="98"> <div align="center">Details </div></td>
            </thead>
            <!-- body dynamic rows -->
            <tbody></tbody>
        </table>
        <br />
        <input type="button" id="deleteRows" value="Delete Last Row">
        <input type="button" id="clearRows" value="Clear Table">
        <center>
</body>
</html>










